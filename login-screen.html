<!DOCTYPE html>
<html>
<head>
	<!-- META -->
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="A collection of datasets for rstats">
	<meta name="keywords" content="David, Christopher, Ruvolo">
	<meta name="author" content="David Ruvolo">
	<!-- LINK -->
	<style type="text/css">
	.header{
		background-color: #F7A072;
		margin-bottom: 2em;
	}

	.header-content{
		width: 90%;
		margin: auto;
		padding:5em 0 5em 0;
		color: white;
	}

	.header-content h1{
		font-size: 5rem;
		margin: 0;
		font-weight: 600;
	}

	.header-content p{
		font-size: 1.5rem;
		font-weight: 400;
	}
	@media screen and (min-width: 800px) {
	
		.container{
			width: 100%;
			margin: auto;
			display: flex;
			justify-content: center;
			align-items: top;
		}

		.column{padding: 35px;}

		.col-main{width: 75%; display: inline-block;}
		.col-side{width: 25%; display: inline-block;}

		.col-side p{
			font-size: 11pt;
			color: #525252;
		}
		.toc-wrapper{
			position: -webkit-sticky;
			position: sticky;
			top: 0;

		}
		.toc-links{list-style: none;}
		.toc-links>li{
			font-size: 14pt;
			line-height: 1.5;
		}
		.toc-links>li:before{
			content: "\25E6";
			width: 1em;
			margin-left: -1em;
			padding: 2px;
			color: #2D7DDD;
		}

		.toc-links-nested{list-style: none;}
		.toc-links-nested li{
			font-size: 11pt;
			line-height: 1.5;
		}
		.toc-links-nested li:before{
			content: "\2014";
			width: 1em;
			margin-left: -1em;
			padding: 2px;
			color: #424242;
		}
		.toc-links-nested li a{color:#424242;}
	}
</style>
<link rel="preload" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400" as="style" onload="this.rel='stylesheet'">
<link rel="preload" href="https://use.fontawesome.com/9ec86712d8.css" as="style" onload="this.rel='stylesheet'">
<!-- <link rel="preload" href="css/styles.css" as="style" onload="this.rel='stylesheet'"> -->
<link rel="preload" href="css/styles.min.css" as="style" onload="this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://use.fontawesome.com/9ec86712d8.css"></noscript>
<!-- <noscript><link rel="stylesheet" href="css/styles.css"></noscript> -->
<noscript><link rel="stylesheet" href="css/styles.min.css"></noscript>
<script>
	/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
	!function(a){"use strict";var b=function(b,c,d){function j(a){if(e.body)return a();setTimeout(function(){j(a)})}function l(){f.addEventListener&&f.removeEventListener("load",l),f.media=d||"all"}var g,e=a.document,f=e.createElement("link");if(c)g=c;else{var h=(e.body||e.getElementsByTagName("head")[0]).childNodes;g=h[h.length-1]}var i=e.styleSheets;f.rel="stylesheet",f.href=b,f.media="only x",j(function(){g.parentNode.insertBefore(f,c?g:g.nextSibling)});var k=function(a){for(var b=f.href,c=i.length;c--;)if(i[c].href===b)return a();setTimeout(function(){k(a)})};return f.addEventListener&&f.addEventListener("load",l),f.onloadcssdefined=k,k(l),f};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
	/*! loadCSS rel=preload polyfill. [c]2017 Filament Group, Inc. MIT License */
	!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(a){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
</script>
<title>dcrData | Shiny App Tutorials</title>
</head>
<body>
	<!-- //////////////////////////////////////////////// -->
	<!-- header -->
	<div class="header">
		<div class="header-content">
			<h1>Shiny Tutorial: Login Screen</h1>
			<p>Tutorial on Building a Simple Password Protected Shiny App</p>
		</div>
	</div>
	<!-- ///////////////////////////////////////// -->
		<div class="breadcrumbs-wrapper">
			<ul class="breadcrumbs">
				<li><a href="index.html"><span class="fa fa-home"></span></a></li>
				<li>Login Screen</li>
			</ul>
		</div>
	<!-- //////////////////////////////////////////////// -->
	<div class="container">
		<div class="column col-side">
			<div class="toc-wrapper">
				<h2>Contents</h2>
				<ul class="toc-links">
					<li><a href="">Back to Top</a></li>
					<li><a href="#login-screen-about">Why would I need a login screen?</a></li>
					<li><a href="#login-screen-work">How does the login screen work?</a></li>
					<li><a href="#login-screen-run">How do I run the demo?</a></li>
					
				</ul>
			</div>
		</div>
		<!-- //////////////////////////////////////////////// -->
		<div class="column col-main">
			<!-- body -->
			<div class="content">
				<!-- //////////////////////////////////////////////// -->
				<!-- App 1 -->
				<div class="app-block" id="login-screen">
					<div class="app-block-header"></div>
					<!-- need -->
					<h2 id="login-screen-about">Why would I need this?</h2>
					<p>You probably don't. The professional shinyapps.io account has a privacy settings that allows you to make apps private, but it does require a subscription. But if you wanted to create an 'protected' shiny app (on a department network or maybe your own server) this could be a potential solution that was inspired by this SO post.</p>
					<!-- work -->
					<h2 id="login-screen-work">How does the app work?</h2>
					<p>The way to visualize the UI structure is that there are three different 'screens': 1. login, 2. standard user UI, and 3. admin UI. When the user logs in, the username/password input is matched to the user account dataset. If the credentials do not match, then an error message is displayed. If successful, the credentials are matched to the corresponding account type (standard or admin), which renders the corresponding UI.</p>
					<h3>1. Write a 1 line UI. Everything is server side</h3>
					<p>This shiny app works by rending the UI on the server side on successful login. The ui.R file looks like this.</p>
					<pre><code>
						<span class="object">ui</span> <- <span class="function">uiOutput</span>(<span class="value">"page"</span>)
					</code></pre>
					<h3>2. Set Login Screen ObserveEvent</h3>
					<p>There is one <code class="inline function">observeEvent</code> that checks the user inputs. This event is triggered when the login button is clicked. Here's what it looks like:</p>
					<pre><code>
					<span class="comment"># On login btn click</span>
				    <span class="function">observeEvent</span>(<span class="value">input$Login</span>,{
				        
				        <span class="comment"># render error message</span>
				        <span class="object">output$message</span> <- <span class="function">renderUI</span>({
			            <span class="function">if</span>(<span class="function">!is.null</span>(<span class="value">input$Login</span>)){
			                <span class="object">my_username</span> <- <span class="function">length</span>(
			                	<span class="object">users$User</span>[<span class="function">grep</span>(
			                		<span class="argument">pattern</span> = <span class="value">input$userName</span>,
			                		<span class="argument">x</span> = <span class="value">users$User</span>)])
			                <span class="object">my_password</span> <- <span class="function">length</span>(
				                <span class="object">users$User</span>[<span class="function">grep</span>(
					                <span class="argument">pattern</span> = <span class="value">input$passwd</span>, 
					                <span class="argument">x</span> = <span class="value">users$Password</span>)])
			                <span class="function">if</span>(<span class="object">input$Login</span> > 0){
			                    <span class="function">if</span>(<span class="object">my_username</span> < 1 ||  <span class="object">my_password</span> < 1){
			                        <span class="function">HTML</span>(<span class="value">&lt;div id='error-box'&gt;
			                             Sorry, that's not the right 
			                             username or password. Please, 
			                             try again. &lt;/div&gt;"</span>)
			                    }
			                }
			            }
				        })
				        
				        <span class="comment"># CHECK INPUT</span>
				        <span class="function">if</span>(<span class="object">USER$Logged</span> == <span class="logical">FALSE</span>) {
			            <span class="function">if</span>(<span class="function">!is.null</span>(<span class="value">input$Login</span>)) {
			                <span class="function">if</span>(<span class="object">input$Login</span> > 0) {
			                    <span class="object">Username</span> <- <span class="function">isolate</span>(<span class="object">input$userName</span>)
			                    <span class="object">Password</span> <- <span class="function">isolate</span>(<span class="object">input$passwd</span>)
			                    <span class="object">Id.username</span> <- <span class="function">which</span>(
					                    <span class="object">users$User</span> == <span class="object">Username</span>
				                		 )
			                    <span class="object">Id.password</span> <- <span class="function">which</span>(
					                    <span class="object">users$Password</span> == <span class="object">Password</span>
					                    )
			                    <span class="function">if</span>(<span class="function">length</span>(<span class="object">Id.username</span>) > 0 
			                    	& <span class="function">length</span>(<span class="object">Id.password</span>) > 0) {
			                        <span class="function">if</span>(<span class="object">Id.username</span> %in% <span class="object">Id.password</span>) {
			                            <span class="object">USER$Logged</span> <- <span class="logical">TRUE</span>
			                        }
			                    }
			                }
			            }
				        }
				    })
					</code></pre>
					<p>In the first block (# render error message), the user input is checked against the list registered users. If the credentials supplied does not match any of the existing accounts, then it displays an error message. The input data is matched with existing accounts by using <code class="inline function">grep</code> to scan through the data for matching username and password, and then returns the length of the data. The return value is numeric and can only have the values of 0 or 1 where 0 equals no match and 1 equals a sucessful match. Both username and password have to return a value of 1 in order to move on.</p>
					<p>The second block (#check input) uses the same method except that when credentials are successfully matched, it sets the object <code class="argument">Logged</code> to TRUE. <code class="argument">Logged</code> is the current status of user where <code class="logical">TRUE</code> equals logged in and <code class="logical">FALSE</code> equals logged out.</p>
					<h2>3. Rendering the UI When Logged = TRUE</h2>
					<p>Rendering the UI is fairly straightforward at this point and can be triggered by a conditional statement.</p>
					<pre><code>
						<span class="package">observe</span>({
				        <span class="comment"># when logged = FALSE</span>
				        <span class="function">if</span> (<span class="object">USER$Logged</span> == <span class="logical">FALSE</span>) {
				            
				            <span class="object">output$page</span> <- <span class="function">renderUI</span>({
				                div(class="outer",<span class="function">do.call</span>(
				                bootstrapPage,c("",ui1())))
				            })
				        }
				        
				        <span class="comment"># Render UI by user type when logged = TRUE</span>
				        <span class="function">if</span> (<span class="object">USER$Logged</span> == <span class="logical">TRUE</span>){

				            <span class="comment">## get the current user's authorization level</span>
				            <span class="object">user_log</span> <- <span class="function">toupper</span>(<span class="value">input$userName</span>)
				            
				            <span class="comment"># if admin</span>
				            <span class="function">if</span>(<span class="object">user_log</span> == <span class="value">"ADMIN"</span>){
				                <span class="object">output$page</span> <- <span class="function">renderUI</span>({
				                    <span class="function">fluidPage</span>(
				                    	<span class="comment">...</span>
				                    	)
				                    )
				                })
				            }
				            
				            <span class="comment"># if standard user</span>
				            <span class="function">else</span>{
				                <span class="object">output$page</span> <- <span class="function">renderUI</span>({
				                    <span class="function">fluidPage</span>(
					                    <span class="comment">...</span>
				                    )
				                })
				            }
				        }
				    })
					</code></pre>
					<h3>Thoughts</h3>
					<p>Honestly, this is some Poltergeist level stuff that for some reason works. I've used this method to create a project management tool to manage daily activities and tasks. It was hosted on department servers and I added this login screen only those with an account could view it. In the real app, the account data was stored separately. I don't see much use for it elsewhere and it was a pain to setup. I wouldn't really use this if you have sensitive information you'd like to protect.</p>
					<!-- run app -->
					<h2 id="login-screen-run">How can I run this app?</h2>
					<p>There are two ways to run this app:</p>
					<pre><code>
						<span class="comment"># 1. Run in R/Rstudio</span>
						<span class="function">install.packages</span>("<span class="package">shiny</span>")

						<span class="package">shiny</span>::<span class="function">runGitHub</span>(
								<span class="argument">repo</span>=<span class="value">"shinyapps"</span>,
								<span class="argument">username</span>=<span class="value">"davidruvolo51"</span>,
								<span class="argument">subdir</span>=<span class="value">"Login-Screen"</span>)

						<span class="comment"># 2. Run from the terminal</span>
						<span class="object">Rscript -e </span>"<span class="package">shiny</span>::<span class="function">runGitHub</span>(
								<span class="argument">repo</span>=<span class="value">"shinyapps"</span>,
								<span class="argument">username</span>=<span class="value">"davidruvolo51"</span>,
								<span class="argument">subdir</span>=<span class="value">"Login-Screen"</span>,
								<span class="argument">launch.browser</span>=<span class="logical">TRUE)</span>
					</code></pre>

					<p>Use one of the following demo accounts to test this app.</p>
					<pre><code>
						<span class="comment"># Test out the app with one of the following accounts.</span>
					
						| type     | Username | password |
						----------------------------------
						| standard | user     | password |
						| standard | test     | test     |
						| admin    | admin    | admin    |
					</code></pre>

					<p>The source code is available on <a class="eLinks" href="https://github.com/davidruvolo51/shinyAppTutorials/tree/master/Login-Screen">github</a>.</p>
					<ul class="tags">
						<li>loginscreen</li>
						<li>useraccounts</li>
						<li>magic</li>
					</ul>
				</div>

			</div>
		</div>
	</div>
</body>
<footer>
	<p>If you'd like to contribute to this collection, open up a pull request on <a href="https://github.com/davidruvolo51/shinyAppTutorials">github</a>.</p>
	<p>Made with <i class="fa fa-heart"></i> and <i class="fa fa-coffee"></i> by <a href="https://davidruvolo51.github.io">david ruvolo</a></p>
</footer>
</html>